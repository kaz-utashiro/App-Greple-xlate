# Greple -Mxlate module sample files

This directory contains an example of using Greple's -Mxlate module to automatically translate a file.

If you are reading this text in a language other than Japanese, it was generated by automatic translation using this system. Please be patient even if there are some strange points. If you are reading this in Japanese and you find something wrong, please be patient or point it out gently, because the author is not right in the head.

Simply place the document file to be translated and execute the make command to generate the necessary file. The following types of files are currently covered.

- `*.docx`, `*.pptx`, and `*.pptx`.
- `*.pptx`, `*.pptx`, and `*.txt`.
- `*.txt`
- `*.md`
- `*.pm`

## Generated files

### For a single ENGINE

If not specified, three types of files, `xtxt`, `cm`, and `ifdef`, will be generated for each target language.

For example, if you want to translate the file `Document.txt` into Japanese, three files named

    Document.txt.JA.xtxt
    Document.txt.JA.cm
    Document.txt.JA.ifdef

という3つのファイルが生成されます。`xtxt` ファイルには、翻訳文章のみ、`cm` と `ifdef` には原文と訳文の両方が含まれます。

### For multiple ENGINE

If both `deepl` and `gpt4` are specified for ENGINE, a file containing the engine name is generated as follows

    Document.txt.deepl-JA.xtxt
    Document.txt.deepl-JA.cm
    Document.txt.deepl-JA.ifdef
    Document.txt.gpt4-JA.xtxt
    Document.txt.gpt4-JA.cm
    Document.txt.gpt4-JA.ifdef

## Wrap lines

The format specification with trailing `-fold`, for example `cm-fold`, wraps the output at 80 columns.

## Control files

If the target file has a file with a specific extension, the translation process can be controlled by its contents. For example, if there is a file called `Document.txt.LANG` along with a file called `Document.txt`, the translation will be done in the language written in the file.

### .ENGINE

Specifies the translation engine. The default `deepl` and `gpt4` can be specified. The default is `deepl`.

### .LANG

Specify the language to be translated.

### .FORMAT

Specify the translation format. Usually, you can specify one of `xtxt`, `cm`, or `ifdef`.

You can also use other formats, such as `md`, in which case the contents will be the same as for `xtxt`. If you generate a file ending with `.md`, it will also be translated next time, so you should use it carefully.

## translation process

The default behavior is to copy the text to be translated to the clipboard, and you will be prompted to process the translation; translate it using the DeepL application or web interface, copy the result back to the clipboard, and then press enter Please press enter.

### character limit

If you are running with a free account, you can only process up to 5000 characters at a time, so repeat this process until all text has been processed.

If you are using a paid account and there is no limit to the number of characters to process, set the variable `MAXLEN` to the upper limit and run.

    make MAXLEN=100000

### Using the DeepL API

To translate using the API, the `deepl` command must be installed. Set the variable `USEAPI` and run make. However, you do not need the `deepl` command if you run on a Docker container.

    make USEAPI=yes

When using the API, the maximum number of characters is set to 128K. The authentication key is set in the environment variable `DEEPL_AUTH_KEY`. Set environment variables such as `DEEPL_SERVER_URL` if necessary.

### Using the Docker container

Run make with the variable `DOCKER` enabled.

    make DOCKER=yes

### `XLATE_OPT` variable

You can also specify options to give to the `xlate` command.

    make XLATE_OPT=-Dam100000

would allow the API to run on Docker with a character limit of 100,000 characters.

## xlate script

Originally, these files were created to be handled by a Makefile, but now the settings used there are more generic and are automatically handled by a script called `xlate`. Thus, the current Makefile simply calls the `xlate` command. The Makefile used by `xlate` is `. /share/XLATE.mk`.

To get help, run `xlate -h`.

### `xlate -M`.

Run make.

### `xlate -D`

Run the xlate command in the Docker environment.

### `xlate -C`

Run the command in the Docker environment.

If you specify `-C` followed by a command, it will execute that command. If nothing is specified, a shell will be launched.

By default, the current directory is mounted in the `/work` directory; if you want to use the git environment, use the following `-G` option.

If you want to mount read-only, use the `-R` option.

#### `xlate -G`

Mount the top directory of the current git repository in the Docker environment.

#### `xlate -GM`

Mount the current git repository and run make in the Docker environment.

You can specify the `-n` option, like `xlate -GMn` if you want to see what command to run.

#### `xlate -GC`

Mount the Git repository and launch a shell in the Docker environment.

Git and a set of other tools are installed, so you can work straight through. Note that it mounts your working directory, so any modifications you make there will be reflected in the original files.
