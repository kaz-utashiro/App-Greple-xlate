バージョン1.1(2023年2月9日)

DNS不正利用技術マトリックス

FIRST DNS Abuse 特別興味グループ

https://www.first.org/global/sigs/dns

はじめに

FIRSTのDNS Abuse Special Interest Group（SIG）による本レポートは、DNSの不正
使用に関わるインシデントに対応するインシデントレスポンスチームへのアドバイス
を提供します。DNSの不正使用とそうでないものの境界を明確に定義することは、難
しい課題です。多くの組織が、DNS不正利用をフィッシング、マルウェア、迷惑メー
ル、ボットネット、詐欺、またはこれらの不正利用の一部またはすべての組み合わせ
に関連するものとして定義することに賛成しています。FIRST DNS Abuse SIGは、こ
れらの分類がインシデント対応担当者に実用的なアドバイスを与えないという、この
話題のギャップを認識しています。そこで、本レポートでは、インシデント対応者や
セキュリティチームが目にするインシデントで使用される技法の一般的な例を示し、
インシデント対応者が悪用に使用される特定の技法を検出、緩和、または防止するの
に役立つと思われる関係者のリストを提供することにより、DNS悪用研究における既
存の取り組みを補完することを目指しています。

現在、このアドバイスは、特定のステークホルダーが特定の技術について直接手助け
できるかどうかを示すマトリックスの形式をとっている。支援」とは、そのステーク
ホルダーが悪用テクニックを検出、軽減、または防止する立場にあるかどうかを意味
する。私たちは、この情報を3つのスプレッドシートに整理し、これらのインシデン
ト対応アクションを網羅しました。例えば、DNSキャッシュポイズニングに関わるイ
ンシデントが発生した場合、チームは「緩和」タブで「DNSキャッシュポイズニング」
の行を参照し、インシデントの緩和を支援するためにどの関係者に連絡することがで
きるかを確認できます。

DNSのエコシステムは複雑で、多くの利害関係者と運用モデルが存在します。リスト
アップされたテクニックの中には良性の用途もあるため、「これらのテクニックは決
して許されるべきではない」というような単純なものではありません。しかし、イン
シデントレスポンスの文脈では、インシデントが発生していることが前提であるため、
敵対者がそのインシデントを開始または維持するために使用した技術は、悪意がある
か、組織のセキュリティポリシーに反するか、その両方である。インシデント対応者
は、管轄の境界内で責任ある収集を行うことを遵守すべきである。DNS Abuse SIGは、
リストアップされた技法がDNS全般を悪用するものであるかどうかについては、一切
関知していない。本報告書は、特定のインシデントにおいて技法が悪意を持って使用
されていると仮定し、検出、軽減、または防止することによって、誰が行動を起こす
ことができるかを明らかにする観点から構成されている。

また、DNSを利用した攻撃と並行して、BGPハイジャックやTLS証明書のなりすましな
ど、いくつかの技術が利用されることがあります。このような技術は対象外であり、
この文書ではDNSの悪用技術にのみ焦点を当てています。

インシデントに対応して連絡できる政策関連、政府、および司法の手段が他にもある
ことに留意することは有益であろう。例えば、ブダペスト条約やその他の国際文書は、
国境を越えた証拠の検索やインフラの停止を行うためのメカニズムを提供しています。
外国の法執行機関の捜査員が最初に行うのは、正式な法的要請（つまりMLAT）がある
までデータが失われないようにするための非公式な保全要請であることが多いでしょ
う。

用語解説

マトリックスの3つの次元（アクション、テクニック、ステークホルダー）には、以
下のような用語の定義が用いられています。

アクション（Action

この定義は、FIRST CSIRT サービスフレームワーク v2.1 とリンクしており、CSIRT 
が提供する可能性のあるサービスについてのものである。

検知 - 潜在的なインシデントを特定する。サービスを提供する。監視と検出、イン
シデントレポートの受理。注：IR チームが追加の検出ツールやシグネチャを確認し
収集したいインシデント管理のフェーズは、Detection ではなく Mitigation フェー
ズに含まれる。検出アクションは、インシデントの初期検出のみに焦点を当てます。

緩和-インシデントを封じ込め、安全なオペレーションを回復する。サービス。サー
ビス：緩和と回復

予防-DNS固有の手順を使用して、この種のインシデントが将来発生する可能性を低く
します。サービスを提供します。ナレッジトランスファー（社内ITチームを含む）、
脆弱性対応、検知（シグネチャーや検知ルールの更新もあり）、復旧（復旧時、再発
防止のためにシステムを再設定すること）にも関連する。なお、広範なマルウェア対
策は対象外である。もちろん、マルウェア対策は誰もが行うべきであり、例えばベス
トプラクティス｜M3AAWGを参照されたい。

テクニック

1. DGA（Domain Generation Algorithms） - https://attack.mitre.org/techniques
/T1568/002/

2. ドメイン名の侵害 - 正当な名前所有者からドメイン名を不当にコントロールする
ことです。侵害されたドメインは、スパムやフィッシングの送信、マルウェアの配布、
ボットネットのコマンド＆コントロール（https://www.icann.org/groups/ssac/
documents/sac-007-en）など、さまざまな種類の悪意のある活動に使用される可能性
があります。

3. レーム委任 - レーム委任は、期限切れのネームサーバー・ドメインの結果として
発生し、攻撃者はこの期限切れのネームサーバー・ドメインを再登録することでドメ
イン解決の主導権を握ることができます - https://blog.apnic.net/2021/03/16/the
-prevalence-persistence-perils-of- lame-nameservers/.

4. DNSキャッシュポイズニング - DNSスプーフィングとも呼ばれるサイバー攻撃の一
種で、攻撃者が偽のDNSレコードを注入することによってDNSリゾルバーのキャッシュ
を破壊し、リゾルバーが攻撃者によって制御されるように記録させるものです - 
https://capec.mitre.org/data/definitions/142.html

5. DNSリバインディング - 悪意のあるウェブサイトがクライアントをローカルネッ
トワークのアドレスに誘導し、攻撃者が同一起源ポリシーをバイパスして被害者のロー
カルリソースにアクセスすることを可能にする攻撃の一種 - https://capec.mitre.
org/data/definitions/275.html

6. DNSサーバーの侵害 - 攻撃者は、オープンな再帰DNSサーバー、権威DNSサーバー、
組織的な再帰DNSサーバー、またはISPが運営する再帰DNSサーバーの管理者権限を獲
得する。

7. Stub resolver hijacking - 攻撃者は、DNSクエリを傍受し、不正または悪意のあ
る応答で応答する悪意のあるコードでコンピュータまたは携帯電話のオペレーティン
グシステムを侵害する。

8. ローカル再帰リゾルバのハイジャック - 家庭用ルータなどのCPE（Consumer 
Premise Equipment）は、ローカルネットワーク上でDNS再帰を提供することが多い。
CPEデバイスが侵害された場合、攻撃者は応答を変更するなどして、再帰性リゾルバ
の動作を変更することができます。

9. オンパスDNS攻撃 - "攻撃者は、ユーザーとDNSサーバー間の通信を傍受し、悪意
のあるサイトを指す異なる宛先IPアドレスを提供します。" (https://www.imperva.
com/learn/application-security/dns-hijacking-redirection/)

10. DNSに対するDoS - 複数のシステムが同時にターゲットに悪意のあるトラフィッ
クを送信すること。

11. DoSのベクトルとしてのDNS - 「攻撃者は、大量のネットワークトラフィックを
ターゲットに反映させることで、サービス拒否を引き起こすことを試みるかもしれま
せん。このタイプのネットワークDoSは、ホストとなり、所定の偽装されたソースIP
アドレスに応答するサードパーティ・サーバーの仲介を利用する。この第三者サーバー
は、一般にリフレクターと呼ばれます。敵対者は、被害者のなりすましアドレスを持
つリフレクターにパケットを送信することで、リフレクション攻撃を実現します。
Reflection Amplification Floodを可能にする2つの著名なプロトコルは、DNSとNTP
であり、その他にもいくつかのプロトコルが野生の状態で使用されていることが文書
化されています。これらのReflectionおよびAmplification Floodsは、権威あるネー
ムサーバーのようなDNSのコンポーネントに対して向けられ、それらを応答不能にす
ることができます。" (https://attack.mitre.org/techniques/T1498/002/)

12. 動的DNS解決（難読化技術として） - 敵は、一般的な検出や修復を回避するため
に、コマンド＆コントロールインフラへの接続を動的に確立する場合があります。こ
れは、敵対者がマルウェアの通信を受信するために使用するインフラストラクチャと
共通のアルゴリズムを共有するマルウェアを使用することによって達成される場合が
あります。これらの計算を利用して、マルウェアがコマンド＆コントロールに使用す
るドメイン名IPアドレスやポート番号などのパラメータを動的に調整することが可能
です。 (https://attack.mitre.org/techniques/T1568/)

13. 動的なDNS解決。ファストフラックス（難読化技術として） - 「攻撃者は、ファ
ストフラックスDNSを使用して、単一のドメイン解決にリンクされた急速に変化する
IPアドレスの配列の背後にコマンド＆コントロールチャネルを隠すことができる。こ
の技術は、DNSリソースレコードのラウンドロビンIPアドレスと短いTTLの組み合わせ
を使用して、高い頻度で交換される複数のIPアドレスが割り当てられた完全修飾ドメ
イン名を使用しています。" (https://attack.mitre.org/techniques/T1568/001/)

14. DNSを介した侵入および流出 - DNSを介した流出には、委任されたドメイン、ま
たはドメインがパブリックDNSに存在しない場合、そのドメインのゾーンファイル情
報をあらかじめ搭載し、侵害されたデバイスが送信するクエリを受信して応答するよ
うに構成されたリゾルバーの運用が必要です。

15. 例えば、被害者を攻撃する前に、敵対者が ICANN 公認のレジストラから、標的
設定時に使用できるドメ インを購入または登録する。CAPEC-630も参照。

16. ダイナミックDNSプロバイダーの下での悪意のあるサブドメインの作成 - 被害者
を攻撃する前に、敵対者はレジストラやレジストリ以外のエンティティから、自分た
ちが所有し管理するドメインの下にサブドメインを提供するドメインを購入または作
成する。https://en.wikipedia.org/wiki/Dynamic_DNS も参照。

17. インターネット攻撃インフラは広範なカテゴリーであり、DNS 以外のサーバも含
まれる。ウェブサーバやメールサーバなど、多くの侵害されたサーバは、DNS と相互
作用し、DNS の悪用に役立てることができる。例えば、フィッシングメールの送信に
使用される可能性のあるメールサーバは、侵害された手法の1つである。

18. 18.なりすまし、または未登録のドメイン名の使用 - ドメイン名が予想される状
況（メールのFromヘッダー、Webページやメッセージ本文のURLなど）において、攻撃
者が管理していないドメイン名、および正当な登録者が管理していないか登録されて
いないドメイン名を供給することです。

19. 登録ドメインのなりすまし - ドメイン名が期待される状況（メールのFromヘッ
ダやWebページやメッセージ本文のURLなど）において、攻撃者が管理していないドメ
イン名を提供し、実際に正当な登録者によって管理されているか登録されている。

20. DNSトンネリング - DNS上で他のプロトコルをトンネリングする - DNSプロトコ
ルは、コンピュータネットワークの管理機能を果たすため、環境では非常に一般的か
もしれない。DNSトラフィックは、ネットワーク認証が完了する前でも許可されるこ
とがある。DNSパケットには、データを隠すことができる多くのフィールドやヘッダー
が含まれています。DNSトンネリングとして知られるように、敵対者はDNSを悪用して、
被害者ネットワーク内の制御下にあるシステムと通信する一方で、通常の予想トラフィッ
クを模倣することがある。(https://attack.mitre.org/techniques/T1071/004/)

21. DNSビーコン - C2通信 - データを流出させるため、またはC2からのさらなるコ
マンドを待つために、コマンド＆コントロールサーバーに連続的または周期的にDNS
クエリーを行う。

ステークホルダー

多くの組織は、異なる時期に異なるステークホルダーの役割を果たすことがある。中
小規模の組織では、同じ個人が異なる時に異なる役割で行動することがある。しかし、
これらの異なるステークホルダーは、それぞれ異なる能力を持っているため、別個の
ものとして整理しています。1つの組織に、異なるステークホルダーの役割として行
動する異なるチームがある場合でも、ステークホルダーの能力を実行する関連チーム
への接触を試みることが有用である場合がある。

インシデント対応者は、すべてのステークホルダーが自分たちの最善の利益を念頭に
置いているわけではないことに留意することが重要である。接触したステークホルダー
は、注意力が散漫であったり、未熟であったり、最悪の場合、意図的に不正使用をサ
ポートするためにインフラを運用している可能性がある。後者のような組織は、よく
言えば無反応、悪く言えば欺瞞に満ちています。ステークホルダーとの接触を進める
かどうか迷った場合は、同業者に確認すること。

1. レジストラ - TLDの下でドメインの登録を許可する組織 - https://www.icann.
org/en/icann-acronyms-and-terms/registrar-en

2. レジストリ - TLDのドメインのデータベースを管理する責任を負う組織 - https:
//www.icann.org/en/icann-acronyms-and-terms/registry-en

3. 権威あるオペレータ - https://www.icann.org/en/icann-acronyms-and- terms/
authoritative-name-server-en

4. ドメイン名再販業者 - https://www.icann.org/resources/pages/reseller-2013-
05-03-en

5. 再帰的演算子 - プライベートまたはパブリックのいずれかの再帰的リゾルバを運
用する組織

6. ネットワーク事業者 - 自律システム（AS）を運用する組織。この機能を持つ組織
は、再帰的なDNSサーバーを実行していないものとする。この欄はネットフローとBGP
データを意味し、パッシブDNSは除外する（ここでは明確な選択事項として）。

7. 7. アプリケーションサービスプロバイダ - Serviceとしてのソフトウェアプロバ
イダ（Google Docsなど）。SaaSの定義については、https://www.iso.org/obp/ui/
#iso:std:iso-iec:17788:ed-1:v1:en。

8. ホスティングプロバイダー - https://en.wikipedia.org/wiki/
Web_hosting_service. ホスティングプロバイダが防弾ホスティングプロバイダであっ
たり、攻撃インフラを提供することに加担している場合、彼らに連絡しても、よくて
も良いことはなく、最悪の場合、チームが報復にさらされることになります。

9. 脅威情報プロバイダ - 脅威情報プロバイダは、意思決定プロセスに必要な文脈を
提供するために、情報を集約、変換、分析、解釈、または濃縮します。CTIは、共有
と分析のみとみなされる。

10. デバイス、OS、およびアプリケーションソフトウェア開発者 - DNSリゾルバソフ
トウェアのコードを記述または開発するソフトウェア開発者、またはソフトウェアプ
ロジェクトにおいてインポートされたDNSリゾルバのバージョンを更新する責任を負
うソフトウェア開発者。

11. ドメイン登録者 - 「ドメイン名を登録する個人または団体」https://www.icann.
org/en/icann-acronyms-and-terms/registrant-en。悪意のある登録行の場合、この
利害関係者は、悪意のある登録を行った実際の人間としてモデル化される。

12. エンドユーザー - インターネットを使用するすべての人（リストされた他の利
害関係者の能力の1つを実行していない人）。

13. 法執行機関および公共安全機関 - 法律の執行または公共の利益のために行動す
る権限を有する政府機関。このような組織は、通常、以下の理由で問題を認識する。

a. LE テクニックが独自の洞察を与える継続的な調査。

b. 被害者の訴えにより、虐待を示す情報が提供され、多くの場合、組織が証拠を理
解するのを助けるために技術的 SME との協力に依存する。

14. CSIRTs / ISACs - Computer Security Incident Response Teams / Information 
Sharing and Analysis Centers. この欄は、チームやセンターの能力のみをモデル化
しています。各 CSIRT と ISAC は、サービスのエンドユーザ、登録者、脅威情報プ
ロバイダなどである。CSIRT や ISAC（組織）が、これらのステークホルダーの能力
を発揮している場合、これらの列を使用する。

15. インシデント対応者 - 影響を受ける組織の内部にいるコンピュータセキュリティ
インシデント対応チーム。

テクニックの例

このSIGは、様々なテクニックの例を集め、FIRST.orgのウェブサイトのDNS Abuse 
SIGのホームページから入手できるようにしています。

https://www.first.org/global/sigs/dns/dns-abuse-examples

この事例リストは、今後もキュレーションされながら更新されていく予定です。

JPCERT/CCは、ドメイン生成アルゴリズム（DGA）や有効なSLDの悪意のある登録など
の手法の例を示すフィッシングURLのリストを公開しました。

Nominetは、ダングリングDNSエントリーが、lame delegationやon-path DNS攻撃手法
の脆弱性につながることを説明した資料を公開しました。

国税庁は、悪意のある登録を利用したSMS詐欺や、対象組織を詐称した詐欺に対する
警告を発表しています。

インシデント対応担当者へのアドバイス

以下の表は、DNSの悪用手法ごとに異なるインシデント対応フェーズにおいて、どの
ような組織と連絡を取れば生産的かについての我々のアドバイスをまとめたものであ
る。ブダペスト条約やその他のネットワークは、国境を越えた証拠の検索やインフラ
の停止を行うためのメカニズムを提供しています。この条約は、例えば、「捜査官の
最初のステップは、正式な法的要請（MLAT）があるまでデータが失われないようにす
るための非公式な保全要請であることが多い」と期待値を設定しています。

不正使用マトリックス

キー

: 脅威を検知・緩和・防止する能力を有している。

: 脅威を検知・緩和・防止する能力を欠いている。

DGA：ドメイン生成アルゴリズム

eSLD：有効なセカンドレベルドメイン

eSLD：有効なセカンドレベルドメイン

pDNS：パッシブDNSトラフィック解析
